\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{float}
\usepackage{minted}
\usepackage{circuitikz}
\usepackage{tikz}
\usetikzlibrary{shapes, arrows, calc, positioning, circuits.logic.US, circuits.logic.IEC}
\usepackage{geometry}
\geometry{a4paper, margin=1in}
\usepackage{hyperref}
\usemintedstyle{trac}

\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\fancyfoot[C]{\small 010153101 Digital Circuit and Microprocessor Fundamental \\ Semester 2/2025}
\fancyfoot[R]{\thepage}

% Redefine plain style to match fancy style (for the title page)
\fancypagestyle{plain}{%
  \fancyhf{}%
  \fancyfoot[C]{\small 010153101 Digital Circuit and Microprocessor Fundamental \\ Semester 2/2025}%
  \fancyfoot[R]{\thepage}%
  \renewcommand{\headrulewidth}{0pt}%
}

\title{Laboratory Exercise 6 - Week 1 \\ Latches and Flip-flops}
\author{}
\date{}

\begin{document}

\maketitle

The purpose of this exercise is to investigate latches, flip-flops, and registers.

\section*{Part I}

Intel FPGAs include flip-flops that are available for implementing a user's circuit. We will show how to make use of these flip-flops in Part IV of this exercise. But first we will show how storage elements can be created in an FPGA without using its dedicated flip-flops.

Figure 1 depicts a gated RS latch circuit. A style of VHDL code that uses logic expressions to describe this circuit is given in Figure 2. If this latch is implemented in an FPGA that has 4-input lookup tables (LUTs), then only one lookup table is needed, as shown in Figure 3a. The operation of the RS latch is behaviorally described in the characteristic table shown in Table \ref{tab:rs_latch_char}.

\begin{figure}[H]
    \centering
    % Placeholder for Figure 1: Gated RS Latch
    \input{tex/lab6p1_gated_rs_latch.tex}
    \caption{A gated RS latch circuit.}
    \label{fig:gated_rs_latch}
\end{figure}

\begin{figure}[H]
    \centering
    \begin{minted}[frame=single, fontsize=\small, linenos]{vhdl}
LIBRARY ieee;
USE ieee.std_logic_1164.all;

ENTITY part1 IS
    PORT ( Clk, R, S : IN STD_LOGIC;
           Q : OUT STD_LOGIC);
END part1;

ARCHITECTURE Structural OF part1 IS
    SIGNAL R_g, S_g, Qa, Qb : STD_LOGIC ;
    ATTRIBUTE KEEP : BOOLEAN;
    ATTRIBUTE KEEP OF R_g, S_g, Qa, Qb : SIGNAL IS TRUE;
BEGIN
    R_g <= R AND Clk;
    S_g <= S AND Clk;
    Qa <= NOT (R_g OR Qb);
    Qb <= NOT (S_g OR Qa);
    Q <= Qa;
END Structural;
    \end{minted}
    \caption{Specifying the RS latch by using logic expressions.}
    \label{fig:vhdl_rs_latch}
\end{figure}

Although the latch can be correctly realized in one 4-input LUT, this implementation does not allow its internal signals, such as $R\_g$ and $S\_g$, to be observed, because they are not provided as outputs from the LUT. To preserve these internal signals in the implemented circuit, it is necessary to include a compiler directive in the code. In Figure 2 the directive KEEP is included by using a VHDL ATTRIBUTE statement to instruct the Quartus compiler to use separate logic elements for each of the signals $R\_g$, $S\_g$, $Qa$, and $Qb$. Compiling the code produces the circuit with four 4-LUTs depicted in Figure 3b.

\begin{figure}[H]
    \centering
    % Placeholder for Figure 3
    \input{tex/lab6p1_rs_latch_luts.tex}
    \caption{Implementation of the RS latch from Figure 1.}
    \label{fig:rs_latch_impl}
\end{figure}


\begin{table}[H]
    \centering
    \begin{tabular}{|c|c|c|c|c|}
        \hline
        Clk & R & S & Q(t+1) & Description \\
        \hline
        0 & x & x & Q(t) & Hold \\
        1 & 0 & 0 & Q(t) & Hold \\
        1 & 0 & 1 & 1 & Set \\
        1 & 1 & 0 & 0 & Reset \\
        1 & 1 & 1 & x & Indeterminate \\
        \hline
    \end{tabular}
    \caption{Characteristic table of the Gated RS Latch.}
    \label{tab:rs_latch_char}
\end{table}

Create a Quartus project for the RS latch circuit as follows:
\begin{enumerate}
    \item Create a new Quartus project for your DE0-CV board.
    \item \textbf{First, implement the circuit using Schematic Design.} Draw the circuit using the Block Editor and appropriate logic gates.
    \item Compile the schematic design and perform a functional simulation to verify its correctness. Ensure the behavior matches the expected RS latch operation.
    \item \textbf{Next, implement the circuit using Structural VHDL Design.}
    \item Generate a VHDL file with the code in Figure 2 and include it in the project.
    \item Compile the code. Use the Quartus RTL Viewer tool to examine the gate-level circuit produced from the code, and use the Technology Map Viewer tool to verify that the latch is implemented as shown in Figure 3b.
    \item Simulate the behavior of your VHDL code by using the simulation feature provided in the Quartus software. First, create a vector waveform file (*.vwf) using the Quartus software to specify the inputs and outputs of your circuit. Then, use the commands available in the Quartus Simulation Waveform Editor tool to run a simulation of the circuit. The resulting waveforms should look similar to those shown in Figure \ref{fig:sim_rs_latch}.
\end{enumerate}

\begin{figure}[H]
    \centering
    % Placeholder for Figure 4
    \input{tex/lab6p1_rs_latch_timing.tex}
    \caption{Expected waveforms for the RS latch.}
    \label{fig:sim_rs_latch}
\end{figure}

\section*{Part II}

Figure 5 shows the circuit for a gated D latch. Its corresponding characteristic table is provided in Table \ref{tab:d_latch_char}.

\begin{figure}[H]
    \centering
    % Placeholder for Figure 5: Gated D Latch
    \input{tex/lab6p2_gated_d_latch.tex}
    \caption{Circuit for a gated D latch.}
    \label{fig:gated_d_latch}
\end{figure}


\begin{table}[H]
    \centering
    \begin{tabular}{|c|c|c|c|}
        \hline
        Clk & D & Q(t+1) & Description \\
        \hline
        0 & x & Q(t) & Hold \\
        1 & 0 & 0 & Reset \\
        1 & 1 & 1 & Set \\
        \hline
    \end{tabular}
    \caption{Characteristic table of the Gated D Latch.}
    \label{tab:d_latch_char}
\end{table}

Perform the following steps:
\begin{enumerate}
    \item Create a new Quartus project.
    \item \textbf{First, implement the circuit using Schematic Design.} Draw the circuit using the Block Editor.
    \item Compile the schematic design and perform a functional simulation to verify its correctness.
    \item \textbf{Next, implement the circuit using Structural VHDL Design.}
    \item Modify the VHDL code from Part I to implement the gated D latch. Use the KEEP directive to ensure that separate logic elements are used to implement the signals R, S\_g, R\_g, Qa, and Qb.
    \item Compile your project and then use the Technology Map Viewer tool to examine the implemented circuit.
    \item Verify that the latch works properly for all input conditions by using functional simulation. Examine the timing characteristics of the circuit by using timing simulation.
    \item Create a new Quartus project which will be used for implementation of the gated D latch on your DE0-CV board. This project should consist of a top-level module that contains the appropriate input and output ports (pins) for your board. Instantiate your latch in this top-level module. Use switch SW0 to drive the D input of the latch, and use SW1 as the Clk input. Connect the Q output to LEDR0.
    \item Include the required pin assignments and then compile your project and download the compiled circuit onto your DE0-CV board.
    \item Test the functionality of your circuit by toggling the D and Clk switches and observing the Q output.
\end{enumerate}

\section*{Part III}

Figure 6 shows the circuit for a master-slave D flip-flop. The characteristic table for this negative-edge triggered flip-flop is shown in Table \ref{tab:ms_ff_char}.

\begin{figure}[H]
    \centering
    % Placeholder for Figure 6: Master-Slave D Flip-Flop
    \input{tex/lab6p3_master_slave_flip_flop.tex}
    \caption{Circuit for a master-slave D flip-flop.}
    \label{fig:master_slave_ff}
\end{figure}


\begin{table}[H]
    \centering
    \begin{tabular}{|c|c|c|c|}
        \hline
        Clk & D & Q(t+1) & Description \\
        \hline
        $\downarrow$ & 0 & 0 & Reset \\
        $\downarrow$ & 1 & 1 & Set \\
        0 & x & Q(t) & Hold \\
        1 & x & Q(t) & Hold \\
        \hline
    \end{tabular}
    \caption{Characteristic table of the Master-Slave D Flip-Flop (Negative-Edge Triggered).}
    \label{tab:ms_ff_char}
\end{table}

Perform the following:
\begin{enumerate}
    \item Create a new Quartus project.
    \item \textbf{First, implement the circuit using Schematic Design.} Create a symbol for the Gated D latch from Part II and use it to build the circuit.
    \item Compile the schematic design and perform a functional simulation to verify its correctness.
    \item \textbf{Next, implement the circuit using Structural VHDL Design.}
    \item Create a VHDL entity/component for the gated D latch from Part II. Then, write a top-level VHDL file that instantiates two copies of this component to implement the master-slave flip-flop.
    \item Include in your project the appropriate input and output ports for your DE0-CV board. Use switch SW0 to drive the D input of the flip-flop, and use SW1 as the Clock input. Connect the Q output to LEDR0.
    \item Include the required pin assignments and then compile your project.
    \item Use the Technology Viewer to examine the D flip-flop circuit, and use simulation to verify its correct operation.
    \item Download the circuit onto your DE0-CV board and test its functionality by toggling the D and Clock switches and observing the Q output.
\end{enumerate}

\vspace{1cm}
\noindent \textbf{Updated By:} R. Sutthaweekul \\
\textbf{Release Date:} 2026-01-01

\end{document}
