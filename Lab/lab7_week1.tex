\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{float}
\usepackage{minted}
\usepackage{circuitikz}
\usepackage{tikz}
\usetikzlibrary{shapes, arrows, calc, positioning, circuits.logic.US, circuits.logic.IEC}
\usepackage{geometry}
\geometry{a4paper, margin=1in}
\usepackage{hyperref}
\usemintedstyle{trac}

\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\fancyfoot[C]{\small 010153101 Digital Circuit and Microprocessor Fundamental \\ Semester 2/2025}
\fancyfoot[R]{\thepage}

\fancypagestyle{plain}{%
  \fancyhf{}%
  \fancyfoot[C]{\small 010153101 Digital Circuit and Microprocessor Fundamental \\ Semester 2/2025}%
  \fancyfoot[R]{\thepage}%
  \renewcommand{\headrulewidth}{0pt}%
}

\title{Laboratory Exercise 7 - Week 1 \\ Counters}
\author{}
\date{}

\begin{document}

\maketitle

The purpose of this exercise is to build and use counters. The designed circuits are to be implemented on an Intel FPGA DE0-CV Board.

\section*{Part I}

Consider the circuit in Figure \ref{fig:counter_struct}. It is a 4-bit synchronous counter which uses four T-type flip-flops. The counter increments its value on each positive edge of the clock if the Enable signal is high. The counter is reset to 0 on the next positive clock edge if the asynchronous Clear input is low. You are to implement an 8-bit counter of this type.

\begin{figure}[H]
    \centering
    \resizebox{0.7\textwidth}{!}{\input{tex/lab7p1_counter_struct.tex}}
    \caption{A 4-bit synchronous counter using T-type flip-flops.}
    \label{fig:counter_struct}
\end{figure}

perform the following steps:
\begin{enumerate}
    \item Write a VHDL file that defines an 8-bit counter by using the structure depicted in Figure \ref{fig:counter_struct}. Your code should include a T flip-flop entity that is instantiated 8 times to create the counter.
    \item Compile the circuit. How many logic elements (LEs) are used to implement your circuit?
    \item Simulate your circuit to verify its correctness.
    \item Augment your VHDL file to use the pushbutton KEY0 as the Clock input and switches SW1 and SW0 as Enable and Clear inputs, and 7-segment displays HEX1-0 to display the hexadecimal count as your circuit operates.
    \item Download your circuit into the FPGA chip and test its functionality.
\end{enumerate}

\begin{figure}[H]
    \centering
    \resizebox{0.7\textwidth}{!}{\input{tex/lab7p1_top_level.tex}}
    \caption{Top-level block diagram of the 8-bit counter.}
    \label{fig:part1_top_level}
\end{figure}

The code for the T flip-flop entity is shown in Figure \ref{fig:t_ff_code}.
For the top-level entity, refer to the block diagram in Figure \ref{fig:part1_top_level}.

\begin{figure}[H]
    \centering
    \begin{minted}[frame=single, fontsize=\small, linenos]{vhdl}
LIBRARY ieee;
USE ieee.std_logic_1164.all;

ENTITY t_ff IS
    PORT ( T, Clk, Clear : IN STD_LOGIC;
           Q : OUT STD_LOGIC);
END t_ff;

ARCHITECTURE Behavior OF t_ff IS
    SIGNAL Q_int : STD_LOGIC;
BEGIN
    PROCESS ( Clk, Clear )
    BEGIN
        IF Clear = '0' THEN
            Q_int <= '0';
        ELSIF RISING_EDGE(Clk) THEN
            IF T = '1' THEN
                Q_int <= NOT Q_int;
            END IF;
        END IF;
    END PROCESS;
    Q <= Q_int;
END Behavior;
    \end{minted}
    \caption{T flip-flop with asynchronous clear.}
    \label{fig:t_ff_code}
\end{figure}

\section*{Part II}

Another way to specify a counter is by using a register and adding 1 to its value. This can be accomplished using the \texttt{ieee.numeric\_std} library and the \texttt{unsigned} type.

\begin{enumerate}
    \item Write a VHDL file for a 16-bit counter using the following statement: \texttt{Q <= Q + 1;}.
    \item Compile the circuit and determine the number of LEs needed.
    \item Use the RTL Viewer to see the structure of this implementation and comment on the differences with the design from Part I.
    \item Implement the counter on your DE0-CV board, using the displays HEX3-0 to show the counter value.
\end{enumerate}

Figure \ref{fig:numeric_std_types} shows how to convert data between different types using \texttt{numeric\_std} library.

\begin{figure}[H]
    \centering
    \resizebox{0.7\textwidth}{!}{\input{tex/numeric_std_conversions.tex}}
    \caption{Data type conversions in \texttt{ieee.numeric\_std}.}
    \label{fig:numeric_std_types}
\end{figure}

\begin{figure}[H]
    \centering
    \begin{minted}[frame=single, fontsize=\small, linenos]{vhdl}
LIBRARY ieee;
USE ieee.std_logic_1164.all;
USE ieee.numeric_std.all;

ENTITY part2 IS
    PORT ( Clk, Reset, Enable : IN STD_LOGIC;
           Q : OUT STD_LOGIC_VECTOR(15 DOWNTO 0));
END part2;

ARCHITECTURE Behavior OF part2 IS
    SIGNAL count_val : UNSIGNED(15 DOWNTO 0);
BEGIN
    PROCESS ( Clk )
    BEGIN
        IF RISING_EDGE(Clk) THEN
            IF Reset = '0' THEN
                count_val <= (OTHERS => '0');
            ELSIF Enable = '1' THEN
                count_val <= count_val + 1;
            END IF;
        END IF;
    END PROCESS;
    Q <= STD_LOGIC_VECTOR(count_val);
END Behavior;
    \end{minted}
    \caption{16-bit counter using \texttt{numeric\_std}.}
    \label{fig:part2_code}
\end{figure}

An implementation example of the counter using \texttt{numeric\_std} is provided in Figure \ref{fig:part2_code}.

\section*{Part III}

Use an LPM from the Library of Parameterized modules to implement a 16-bit counter. Choose the LPM options to be consistent with the above design, i.e. with enable and asynchronous clear.

\begin{enumerate}
    \item Create a VHDL file that instantiates \texttt{lpm\_counter}.
    \item Compare this version with the previous designs in terms of LE usage.
    \item Verify using simulation.
\end{enumerate}

\begin{figure}[H]
    \centering
    \input{tex/lab7p3_lpm_block.tex}
    \caption{LPM Counter Block.}
    \label{fig:lpm_counter}
\end{figure}
Figure \ref{fig:lpm_counter} shows the LPM counter block representation.



\vspace{1cm}
\noindent \textbf{Updated By:} R. Sutthaweekul \\
\textbf{Release Date:} 2026-01-02

\end{document}
